import{B as p}from"./index-79660912.js";const g=(e,t)=>t.some(n=>e instanceof n);let M,S;function A(){return M||(M=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function W(){return S||(S=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const j=new WeakMap,b=new WeakMap,L=new WeakMap,y=new WeakMap,h=new WeakMap;function T(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{n(c(e.result)),o()},i=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",i)});return t.then(n=>{n instanceof IDBCursor&&j.set(n,e)}).catch(()=>{}),h.set(t,e),t}function k(e){if(b.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{n(),o()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});b.set(e,t)}let B={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return b.get(e);if(t==="objectStoreNames")return e.objectStoreNames||L.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return c(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function v(e){B=e(B)}function F(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(l(this),t,...n);return L.set(r,t.sort?t.sort():[t]),c(r)}:W().includes(e)?function(...t){return e.apply(l(this),t),c(j.get(this))}:function(...t){return c(e.apply(l(this),t))}}function V(e){return typeof e=="function"?F(e):(e instanceof IDBTransaction&&k(e),g(e,A())?new Proxy(e,B):e)}function c(e){if(e instanceof IDBRequest)return T(e);if(y.has(e))return y.get(e);const t=V(e);return t!==e&&(y.set(e,t),h.set(t,e)),t}const l=e=>h.get(e);function N(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const i=indexedDB.open(e,t),f=c(i);return r&&i.addEventListener("upgradeneeded",a=>{r(c(i.result),a.oldVersion,a.newVersion,c(i.transaction),a)}),n&&i.addEventListener("blocked",a=>n(a.oldVersion,a.newVersion,a)),f.then(a=>{s&&a.addEventListener("close",()=>s()),o&&a.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),f}const K=["get","getKey","getAll","getAllKeys","count"],R=["put","add","delete","clear"],I=new Map;function E(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(I.get(t))return I.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=R.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||K.includes(n)))return;const s=async function(i,...f){const a=this.transaction(i,o?"readwrite":"readonly");let d=a.store;return r&&(d=d.index(f.shift())),(await Promise.all([d[n](...f),o&&a.done]))[0]};return I.set(t,s),s}v(e=>({...e,get:(t,n,r)=>E(t,n)||e.get(t,n,r),has:(t,n)=>!!E(t,n)||e.has(t,n)}));const G=["continue","continuePrimaryKey","advance"],P={},x=new WeakMap,O=new WeakMap,_={get(e,t){if(!G.includes(t))return e[t];let n=P[t];return n||(n=P[t]=function(...r){x.set(this,O.get(this)[t](...r))}),n}};async function*$(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,_);for(O.set(n,t),h.set(n,l(t));t;)yield n,t=await(x.get(n)||t.continue()),x.delete(n)}function C(e,t){return t===Symbol.asyncIterator&&g(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&g(e,[IDBIndex,IDBObjectStore])}v(e=>({...e,get(t,n,r){return C(t,n)?$:e.get(t,n,r)},has(t,n){return C(t,n)||e.has(t,n)}}));let w=null;const z=()=>w||(w=N("words-db",1,{upgrade(e){e.createObjectStore("words",{keyPath:"id",autoIncrement:!0}).createIndex("id","id",{unique:!0}),e.createObjectStore("config",{keyPath:"id"}).createIndex("id","id",{unique:!0})}}),w),u=z(),D="words",m="config",J=p("Words",{state:()=>({words:[]}),actions:{async get(){return await(await u).getAllFromIndex(D,"id")},async save(e){const n=(await u).transaction(D,"readwrite");if(e.id){const r=n.store.index("id");for await(const o of r.iterate(e.id)){const s=Object.assign(o.value,e);o.update(s)}return await n.done,e.id}else{const r=await n.store.add(e);return await n.done,r}},async del(e){await(await u).delete(D,e)}}}),Q=p("Config",{state:()=>({config:{voice:!1,syllables:!0,review:!1,view:!1}}),actions:{async get(){const e=await(await u).getAllFromIndex(m,"id")||[];return this.config=e.reduce((t,n)=>(t[n.id]=n.value,t),{}),e},async update(e){const n=(await u).transaction(m,"readwrite"),r=n.store.index("id");for await(const o of r.iterate(e.id)){const s=Object.assign(o.value,e);o.update(s)}return await n.done,await this.get(),e.id},async save(e){const n=(await u).transaction(m,"readwrite"),r=await n.store.add(e);return await n.done,this.get(),r}}});export{Q as a,J as u};
